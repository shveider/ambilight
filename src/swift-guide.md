# AMBILIGHT НА SWIFT - ПОВНА ІНСТРУКЦІЯ

## КРОК 1: Скомпілюй
────────────────

$ swiftc -O AmblightFull.swift -o ambilight

Чекай ~15-30 секунд (компіляція)


## КРОК 2: Запусти
───────────────

$ ./ambilight /dev/tty.usbserial-1320

Або просто (порт за замовчуванням):

$ ./ambilight


## РЕЗУЛЬТАТ:
──────────

✓ Serial port opened: /dev/tty.usbserial-1320
⚡ AMBILIGHT - Full Swift Version
🚀 Target FPS: 60
📐 LED Order: TOP(57) → RIGHT(32) → BOTTOM(57) → LEFT(32)

📊 Frame 60 | FPS: 60.5 | Total: 1.0s
📊 Frame 120 | FPS: 59.8 | Total: 2.0s

ГОТОВО! 🎉 LED світять! 🎉


╔════════════════════════════════════════════════════════════════════╗
║              СИСТЕМНІ ВИМОГИ                                       ║
╚════════════════════════════════════════════════════════════════════╝

✅ macOS 10.12+ (з AppKit)
✅ Swift 5.0+ встановлена
✅ Xcode Command Line Tools
✅ Arduino підключена на /dev/tty.usbserial-*


╔════════════════════════════════════════════════════════════════════╗
║              ДЕТАЛЬНА КОМПІЛЯЦІЯ                                   ║
╚════════════════════════════════════════════════════════════════════╝

БАЗОВА КОМПІЛЯЦІЯ:
──────────────────

$ swiftc AmblightFull.swift -o ambilight

Результат: executable файл ~2 MB


З ОПТИМІЗАЦІЄЮ (-O):
────────────────────

$ swiftc -O AmblightFull.swift -o ambilight

Результат: оптимізований exe файл
Час компіляції: 15-30 сек
Швидкість: 60+ FPS


МЕГА-ОПТИМІЗАЦІЯ (-Osize):
───────────────────────────

$ swiftc -Osize AmblightFull.swift -o ambilight

Результат: мінімальний файл (~1.5 MB)
Час компіляції: 20-40 сек
Швидкість: 50+ FPS

РЕКОМЕНДУЄТЬСЯ: -O (баланс швидкості й розміру)


╔════════════════════════════════════════════════════════════════════╗
║                  ПАРАМЕТРИ ЗАПУСКУ                                 ║
╚════════════════════════════════════════════════════════════════════╝

СТАНДАРТНИЙ ЗАПУСК:
───────────────────

$ ./ambilight

Використовує порт: /dev/tty.usbserial-1320 (за замовчуванням)


З ВКАЗАНИМ ПОРТОМ:
──────────────────

$ ./ambilight /dev/tty.usbserial-1320
$ ./ambilight /dev/ttyUSB0
$ ./ambilight /dev/cu.SLAB_USBtoUART


ЗНАЙДИ СВІЙ ПОРТ:
─────────────────

$ ls /dev/tty.*

# Або на Linux:
$ ls /dev/ttyUSB*
$ ls /dev/ttyACM*


╔════════════════════════════════════════════════════════════════════╗
║                    ОСОБЛИВОСТІ КОДУ                                ║
╚════════════════════════════════════════════════════════════════════╝

✅ ВКЛЮЧЕНО:
• GPU захоплення екрану (Metal)
• Color correction (RGB балансування)
• Gamma correction (гладкі переходи)
• Розрахунок середнього кольору
• Serial port комунікація
• Статистика FPS
• Обробка сигналів (Ctrl+C)

❌ НЕ ВКЛЮЧЕНО:
• PNG декодування (використовує macOS вбудовані функції)
• Помилки обробки (спрощена версія)
• Нескінченні повторні спроби при помилках


╔════════════════════════════════════════════════════════════════════╗
║                   АРХІТЕКТУРА КОДУ                                 ║
╚════════════════════════════════════════════════════════════════════╝

AmblightFull.swift структура:

┌─────────────────────────┐
│   1. Constants          │ ← Налаштування
├─────────────────────────┤
│   2. Color Correction   │ ← RGB балансування
├─────────────────────────┤
│   3. Screen Capture     │ ← Metal GPU
├─────────────────────────┤
│   4. Image Processing   │ ← Обробка пікселів
├─────────────────────────┤
│   5. Frame Building     │ ← Формування даних для LED
├─────────────────────────┤
│   6. Serial Port        │ ← Передача на Arduino
├─────────────────────────┤
│   7. Ambilight Class    │ ← Основний цикл
├─────────────────────────┤
│   8. Main Entry Point   │ ← Старт програми
└─────────────────────────┘


╔════════════════════════════════════════════════════════════════════╗
║                НАЛАШТУВАННЯ (ОПЦІОНАЛЬНО)                          ║
╚════════════════════════════════════════════════════════════════════╝

ЗМІНИТИ FPS:
────────────

let FPS = 60  ← Цей рядок

Вибір:
• 30 = норм для більшості
• 60 = плавна (рекомендується)
• 120 = дуже плавна (якщо хватить GPU)


ЗМІНИТИ СЕРІЙНИЙ ПОРТ:
──────────────────────

let serialPort = CommandLine.arguments.count > 1
    ? CommandLine.arguments[1]
    : "/dev/tty.usbserial-1320"  ← Цей рядок

Або просто передай аргумент:
$ ./ambilight /dev/ttyUSB0


ЗМІНИТИ ШИРИНУ ЗАХОПЛЕННЯ:
──────────────────────────

let RESIZE_WIDTH = 320  ← Цей рядок

• 240 = 2× швидше, гірша якість
• 320 = баланс (рекомендується)
• 480 = краща якість, повільніше


ЗМІНИТИ COLOR CORRECTION:
─────────────────────────

let COLOR_CORRECTION = (red: 1.0, green: 0.95, blue: 0.85)

Приклади:
• (1.0, 1.0, 1.0) = без коригування
• (1.0, 0.9, 0.8) = менше синього
• (1.2, 1.0, 1.0) = більше червоного


╔════════════════════════════════════════════════════════════════════╗
║                  МОНІТОР ШВИДКОСТІ                                 ║
╚════════════════════════════════════════════════════════════════════╝

Консоль показує статистику кожні 60 фреймів:

📊 Frame 60 | FPS: 60.5 | Total: 1.0s
↑          ↑             ↑
Номер    Поточний FPS  Загальний час

Інтерпретація:

• FPS 60+ ✅ = Ідеально!
• FPS 45-60 ✅ = Добре
• FPS 30-45 ⚠️  = Normale, можна краще
• FPS <30 ❌ = Повільно, вимкни інші програми


╔════════════════════════════════════════════════════════════════════╗
║              РОЗВ'ЯЗАННЯ ПРОБЛЕМ                                   ║
╚════════════════════════════════════════════════════════════════════╝

❌ "Command 'swiftc' not found"
→ Встанови: xcode-select --install

❌ "Segmentation fault при запуску"
→ Спробуй компілювати без -O:
$ swiftc AmblightFull.swift -o ambilight

❌ "Permission denied ./ambilight"
→ Дай дозвіл: chmod +x ./ambilight

❌ "Failed to open serial port"
→ Перевір порт:
$ ls /dev/tty.* | grep -i usb
→ Передай правильний порт:
$ ./ambilight /dev/tty.YOUR_PORT

❌ "FPS занизький (30 замість 60)"
→ Закрий інші програми
→ Спробуй зменшити RESIZE_WIDTH на 240

❌ "LED не світять"
→ Перевір Arduino підключення
→ Перевір LED тестовим кодом
→ Перевір серійний порт правильність

❌ "Swift compiler error"
→ Переконайся Swift версія 5.0+:
$ swift --version
→ Оновити Xcode:
$ xcode-select --install --force


╔════════════════════════════════════════════════════════════════════╗
║              ПОРІВНЯННЯ ІЗ NODE.JS                                 ║
╚════════════════════════════════════════════════════════════════════╝

SWIFT (AmblightFull.swift):
────────────────────────────

✅ Переваги:
• Один файл
• Компільований (швидше)
• Без залежностей
• 60+ FPS легко
• Менше кода
• Швидкий старт

❌ Недоліки:
• Тільки macOS
• Потрібно Swift встановлена
• Компіляція займає час


NODE.JS (ambilight_fastest.ts):
────────────────────────────────

✅ Переваги:
• Cross-platform (Windows/Linux)
• Легко редагувати
• Розширюючи можливості

❌ Недоліки:
• Залежить від Node.js
• Залежить від npm модулів
• Трошки повільніше


РЕКОМЕНДАЦІЯ:

На Mac → Swift (AmblightFull.swift) ⭐
Інші ОС → Node.js (ambilight_fastest.ts)


╔════════════════════════════════════════════════════════════════════╗
║                   ФІНАЛЬНИЙ ЧЕКЛИСТ                                ║
╚════════════════════════════════════════════════════════════════════╝

Перед запуском:

☑️  Swift встановлена (swift --version)
☑️  AmblightFull.swift у проекті
☑️  Arduino прошита
☑️  Arduino підключена
☑️  Serial порт перевірений (ls /dev/tty.*)
☑️  LED тестовані
☑️  Дозволи встановлені (chmod +x если потрібно)

Компіляція:
☑️  $ swiftc -O AmblightFull.swift -o ambilight

Запуск:
☑️  $ ./ambilight /dev/tty.YOUR_PORT

Результат:
☑️  ⚡ AMBILIGHT - Full Swift Version
☑️  🚀 Target FPS: 60
☑️  📊 Frame XXX | FPS: 60.X

ГОТОВО! 🎉 LED світять! 🎉


╔════════════════════════════════════════════════════════════════════╗
║                     ВИСНОВОК                                       ║
╚════════════════════════════════════════════════════════════════════╝

Цей Swift код - це найшвидша & найпрямша реалізація Ambilight!

Все на одній мові → простіше розуміти
Компільований → швидше виконувати
Один файл → легше розповсюджувати

Просто:
$ swiftc -O AmblightFull.swift -o ambilight
$ ./ambilight

І готово! 🚀
*/